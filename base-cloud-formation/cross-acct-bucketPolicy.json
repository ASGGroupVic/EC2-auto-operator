{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Common S3 Buckets for Resi Data Analytics",
  "Parameters": {
    "IREDataBucketName": {
      "Description": "Name of S3 bucket that ResiData need to access to",
      "Type": "String"
    },
    "principalList": {
      "Description":"list of residata AccountIDs that permitted access",
      "Type": "CommaDelimitedList"
    }
  },
  "Resources": {
    "IREDataBucketPolicy": {
      "Type": "AWS::S3::BucketPolicy",
      "Metadata": {
        "177242442824": "Residata Dev",
        "563560393941": "Residata Prod"
      },
      "Properties": {
        "Bucket": {
          "Ref": "IREDataBucketName"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Principal":{
                "AWS": {"Ref":"principalList"}
              },
              "Action": [
                "s3:List*",
                "s3:GetObject"

              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::",
                      {
                        "Ref": "IREDataBucketName"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::",
                      {
                        "Ref": "IREDataBucketName"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  }
}